Unit DrillSimStartup;

Interface

Uses Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, StdCtrls,
  ExtCtrls,
     DrillSimVariables,
     HyCalcVariables,
     DrillSimUnitsOfMeasure,
     DrillSimUtilities,
     DrillSimFile,
     DrillSimMessageToMemo,
     DrillSimDataResets;

Procedure StartUp;

Implementation

{ ----------------- Initialize Data --------------------- }

Procedure LoadDefaultWellDataFile(S : String120);
Begin                                        { Extract path string }
  if FileExists(S) then
  Begin
    CurrentFQFileName:=S;      { set file to user defined file }
    CreateNewFile:=False;      { its an existing file }
    StringToMemo('DrillSimStartup.LoadDefaultWellDataFile: Loading well data file ' + CurrentFQFileName + '...');

    LoadData;  { sets NoFileDefined=True if error during read }

    if NoFileDefined=True then // on return, is a valid file loaded?
    Begin                      // then notify the error
      StringToMemo('DrillSimStartup.LoadDefaultWellDataFile: Error loading well data file ' + CurrentFQFileName);
      ShowMessage('Error loading well data file ' + CurrentFQFileName);
    end else
    Begin                      // otherwise confirm well name loaded
      StringToMemo('DrillSimStartup.LoadDefaultWellDataFile: Default well data file ' + CurrentFQFileName + ' loaded');
      StringToMemo('DrillSimStartup.LoadDefaultWellDataFile: Simulating Well ' + Data.WellName);
    End;
  End else
  Begin
    StringToMemo('DrillSimStartup.LoadDefaultWellDataFile: Error - missing well data file ' + CurrentFQFileName);
    NoFileDefined:=True;
  end;
End;



Procedure StartUp;
Begin
  StringToMemo('DrillSimStartup.StartUp: Running DrillSim StartUp.................');
  OriginalExitProc:=ExitProc;
{  ExitProc:=@Abort; }                  { Set Error trap vector  }

  Quit:=False;                          { Initialise Simulator Quit indicator }
  NoFileDefined:=True;  // we are a blank
  CreateNewFile:=True;                  { new file until we know otherwise... }

  HoleError:=False;

  PosCounter:=1;
  TempString:='';
  Instring:='';
  CurrentFQFileName:='';
  DefaultWellDataFile:='';
  DefaultDirectory:='';

  APIUnits;     { Initial default unit type   }
                {* set UoMLabel, UoMCOnverter and UoMDescriptor *}

  InitData;     { zero all main file variables }

    { ------- get default directory ------- }

  GetDir(0,OriginDirectory);               { get current directory spec}
  StringToMemo('DrillSimStartup.StartUp: Current directory is ' + OriginDirectory);
  SystemPropertiesFile:=OriginDirectory + '/' + 'DrillSim.cfg';

    { ------- get defaults file ------- }

  AssignFile(Textfile,SystemPropertiesFile);         { /path/drillsim.cfg }
  StringToMemo('Loading system onfiguration');
  StringToMemo('DrillSimStartup.StartUp: Configuration file is ' + SystemPropertiesFile);

  {$I-}
  Reset(TextFile);
  {$I+}
  if OK then                  { drillsim.CFG found }
  Begin
    While not EOF(TextFile) do
    Begin
      Readln(TextFile,DefaultWellDataFile); { read location of default well file into DefaultFile }
    End;
    CloseFile(TextFile);

    StringToMemo('DrillSimStartup.StartUp: Default well data file is ' + DefaultWellDataFile);

    LoadDefaultWellDataFile(DefaultWellDataFile);     // Load the default data file !!!
  End else
  Begin                  { defaults file not found }
    ShowMessage('Error loading ' + DefaultWellDataFile);
  End;

  {* --------- Load Help File --------- *}

  MessageToMemo(103); // 'Loading application help file...'

  Assign(HelpFile,'DrillSim.hlp');                   { load help messages }
  {$I-}
  Reset(HelpFile);
  {$I+}
  if OK then
  Begin
    HelpFileFound:=True;
    //Read(HelpFile,Help);
    Close(HelpFile);
  End else
  Begin
    HelpFileFound:=False;
    ShowMessage('Error loading DrillSim help file');
  End;
  StringToMemo('DrillSimStartup.StartUp: DrillSim Startup complete');
  ThisString:=Data.WellName;
    writeln(ThisString);

  StringToMemo('DrillSimStartup.StartUp: Using Well ' + ThisString + '');
  StringToMemo('DrillSimStartup.StartUp: Units selected: '+ UoMDescriptor);

End;

Begin
End.

